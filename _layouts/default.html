<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}">
  {% seo %}
  <style>
    :root{
      --bg-image-light: url("{{ '/assets/img/bg2-desktop-2880x1620.webp' | relative_url }}");
      --bg-image-dark: url("{{ '/assets/img/bg2-night-desktop-2880x1620.webp' | relative_url }}");
      --bg-image-mobile-light: var(--bg-image-light);
      --bg-image-mobile-dark: var(--bg-image-dark);
    }
    @media (max-width: 768px){
      :root{
        --bg-image-light: var(--bg-image-mobile-light);
        --bg-image-dark: var(--bg-image-mobile-dark);
      }
    }
  </style>
</head>
<body>
  <header class="site-header" id="siteHeader">
    <div class="site-header__inner">
      <a class="brand" href="{{ '/' | relative_url }}">{{ site.title }}</a>
      <div class="site-header__actions">
        <button class="mobile-menu-toggle" id="mobileMenuToggle" type="button" aria-label="Menu aç/kapat" aria-expanded="false" aria-controls="mobileMenu">
          <span class="mobile-menu-toggle__line" aria-hidden="true"></span>
          <span class="mobile-menu-toggle__line" aria-hidden="true"></span>
          <span class="mobile-menu-toggle__line" aria-hidden="true"></span>
        </button>
        <nav class="main-nav" aria-label="Hoofdmenu">
          <a href="{{ '/' | relative_url }}">Home</a>
          <a href="{{ '/blog/' | relative_url }}">Blog</a>
          <a href="{{ '/about' | relative_url }}">Over</a>
        </nav>
        <button class="theme-toggle" id="themeToggle" type="button" aria-pressed="false" aria-label="Schakel thema">
          <span aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </header>

  <div class="mobile-menu" id="mobileMenu" aria-hidden="true">
    <div class="mobile-menu__backdrop" id="mobileMenuBackdrop" aria-hidden="true"></div>
    <div class="mobile-menu__panel" role="dialog" aria-modal="true" aria-label="Navigatie">
      <nav class="mobile-nav" aria-label="Mobiel hoofdmenu">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="{{ '/blog/' | relative_url }}">Blog</a>
        <a href="{{ '/about' | relative_url }}">Over</a>
      </nav>
    </div>
  </div>

  <main class="page">
    {{ content }}
  </main>

  <footer class="site-footer">
    <div class="shell">
      <small>© {{ site.time | date: '%Y' }} {{ site.title }}</small>
    </div>
  </footer>

  <script>
    (function(){
      const STORAGE_KEY = 'theme';
      const root = document.documentElement;
      const body = document.body;
      const toggle = document.getElementById('themeToggle');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      const menuToggle = document.getElementById('mobileMenuToggle');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileBackdrop = document.getElementById('mobileMenuBackdrop');
      const mobileNavLinks = mobileMenu ? mobileMenu.querySelectorAll('a') : [];

      function getStored(){
        try {
          const value = localStorage.getItem(STORAGE_KEY);
          return value === 'light' || value === 'dark' ? value : null;
        } catch (_) {
          return null;
        }
      }

      function store(value){
        try {
          if (value) localStorage.setItem(STORAGE_KEY, value);
          else localStorage.removeItem(STORAGE_KEY);
        } catch (_) {}
      }

      function systemTheme(){
        return prefersDark.matches ? 'dark' : 'light';
      }

      function currentTheme(){
        return root.getAttribute('data-theme') || systemTheme();
      }

      function setTheme(next){
        if (next === 'dark' || next === 'light') {
          root.setAttribute('data-theme', next);
          store(next);
        } else {
          root.removeAttribute('data-theme');
          store(null);
        }
        updateToggle();
      }

      function updateToggle(){
        const mode = currentTheme();
        toggle.dataset.mode = mode;
        toggle.setAttribute('aria-pressed', mode === 'dark');
        toggle.setAttribute('aria-label', mode === 'dark' ? 'Schakel naar dagmodus' : 'Schakel naar nachtmodus');
      }

      function openMenu(){
        if (!mobileMenu || !menuToggle) return;
        mobileMenu.classList.add('is-open');
        menuToggle.classList.add('is-open');
        menuToggle.setAttribute('aria-expanded', 'true');
        mobileMenu.setAttribute('aria-hidden', 'false');
        body.classList.add('menu-open');
      }

      function closeMenu(){
        if (!mobileMenu || !menuToggle) return;
        mobileMenu.classList.remove('is-open');
        menuToggle.classList.remove('is-open');
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
        body.classList.remove('menu-open');
      }

      const stored = getStored();
      if (stored) {
        root.setAttribute('data-theme', stored);
      }
      updateToggle();

      toggle.addEventListener('click', () => {
        const next = currentTheme() === 'dark' ? 'light' : 'dark';
        setTheme(next);
      });

      toggle.addEventListener('dblclick', () => setTheme(null));

      prefersDark.addEventListener?.('change', () => {
        if (!getStored()) updateToggle();
      });

      menuToggle?.addEventListener('click', () => {
        if (mobileMenu?.classList.contains('is-open')) closeMenu();
        else openMenu();
      });

      mobileBackdrop?.addEventListener('click', closeMenu);
      mobileNavLinks.forEach(link => link.addEventListener('click', closeMenu));
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && mobileMenu?.classList.contains('is-open')) {
          closeMenu();
        }
      });

      const header = document.getElementById('siteHeader');
      let lastScrollY = window.scrollY;
      let ticking = false;
      let headerHeight = header ? header.offsetHeight : 0;

      function updateHeaderVisibility(){
        if (!header) return;
        const currentY = window.scrollY;
        const threshold = headerHeight * 0.65;
        const scrollingDown = currentY > lastScrollY;
        const scrollingUp = currentY < lastScrollY;

        if (currentY <= threshold || scrollingUp) {
          header.classList.remove('is-hidden');
        } else if (scrollingDown && currentY > threshold) {
          header.classList.add('is-hidden');
        }

        lastScrollY = currentY;
      }

      function onScroll(){
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          updateHeaderVisibility();
          ticking = false;
        });
      }

      function onResize(){
        if (!header) return;
        headerHeight = header.offsetHeight;
        updateHeaderVisibility();
        if (window.innerWidth > 768) closeMenu();
      }

      headerHeight = header ? header.offsetHeight : 0;
      updateHeaderVisibility();

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', onResize, { passive: true });

    })();
  </script>
</body>
</html>
