<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}">
  {% seo %}
  <style>
    :root{
      --bg-image-light: url("{{ '/assets/img/bg2-desktop-2880x1620.webp' | relative_url }}");
      --bg-image-dark: url("{{ '/assets/img/bg2-night-desktop-2880x1620.webp' | relative_url }}");
      --bg-image-mobile-light: var(--bg-image-light);
      --bg-image-mobile-dark: var(--bg-image-dark);
    }
    @media (max-width: 768px){
      :root{
        --bg-image-light: var(--bg-image-mobile-light);
        --bg-image-dark: var(--bg-image-mobile-dark);
      }
    }
  </style>
</head>
<body>
  <header class="site-header" id="siteHeader">
    <div class="site-header__inner">
      <a class="brand" href="{{ '/' | relative_url }}">{{ site.title }}</a>
      <div class="site-header__right">
        <nav class="main-nav" aria-label="Hoofdmenu">
          <a href="{{ '/' | relative_url }}">Home</a>
          <a href="{{ '/blog/' | relative_url }}">Blog</a>
          <a href="{{ '/about' | relative_url }}">Over</a>
        </nav>
        <button class="theme-toggle" id="themeToggle" type="button" aria-pressed="false" aria-label="Schakel thema">
          <span aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </header>

  <main class="page">
    {{ content }}
  </main>

  <footer class="site-footer">
    <div class="shell">
      <small>© {{ site.time | date: '%Y' }} {{ site.title }}</small>
    </div>
  </footer>

  <script>
    (function(){
      const STORAGE_KEY = 'theme';
      const root = document.documentElement;
      const toggle = document.getElementById('themeToggle');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      const header = document.getElementById('siteHeader');
      let lastScrollY = window.scrollY;
      let ticking = false;

      function getStored(){
        try {
          const value = localStorage.getItem(STORAGE_KEY);
          return value === 'light' || value === 'dark' ? value : null;
        } catch (_) {
          return null;
        }
      }

      function store(value){
        try {
          if (value) localStorage.setItem(STORAGE_KEY, value);
          else localStorage.removeItem(STORAGE_KEY);
        } catch (_) {}
      }

      function systemTheme(){
        return prefersDark.matches ? 'dark' : 'light';
      }

      function currentTheme(){
        return root.getAttribute('data-theme') || systemTheme();
      }

      function setTheme(next){
        if (next === 'dark' || next === 'light') {
          root.setAttribute('data-theme', next);
          store(next);
        } else {
          root.removeAttribute('data-theme');
          store(null);
        }
        updateToggle();
      }

      function updateToggle(){
        const mode = currentTheme();
        toggle.dataset.mode = mode;
        toggle.setAttribute('aria-pressed', mode === 'dark');
        toggle.setAttribute('aria-label', mode === 'dark' ? 'Schakel naar dagmodus' : 'Schakel naar nachtmodus');
      }

      const stored = getStored();
      if (stored) {
        root.setAttribute('data-theme', stored);
      }
      updateToggle();

      toggle.addEventListener('click', () => {
        const next = currentTheme() === 'dark' ? 'light' : 'dark';
        setTheme(next);
      });

      toggle.addEventListener('dblclick', () => setTheme(null));

      prefersDark.addEventListener?.('change', () => {
        if (!getStored()) updateToggle();
      });

      function syncHeaderHeight(){
        if (!header) return;
        const height = header.offsetHeight;
        root.style.setProperty('--header-height', `${Math.round(height)}px`);
      }

      function updateHeaderVisibility(){
        if (!header) return;
        const currentY = window.scrollY;
        const threshold = header.offsetHeight * 0.6;
        const scrollingDown = currentY > lastScrollY;
        const scrollingUp = currentY < lastScrollY;

        if (currentY <= threshold || scrollingUp) {
          header.classList.remove('is-hidden');
        } else if (scrollingDown && currentY > threshold) {
          header.classList.add('is-hidden');
        }

        lastScrollY = currentY;
      }

      function onScroll(){
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          updateHeaderVisibility();
          ticking = false;
        });
      }

      syncHeaderHeight();
      updateHeaderVisibility();

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', () => {
        syncHeaderHeight();
        updateHeaderVisibility();
      });
    })();
  </script>
</body>
</html>
